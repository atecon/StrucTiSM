set verbose off
clear

set assert stop
include assertion.gfn

include "./src/StrucTiSM.inp" --force


print "Specification 1"
open bikesharing.gdt --quiet

bundle model = STSM_setup(cnt)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)

print "Specification 2"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE)
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)
assert(nelem(model.seasonal_info) == 0)


print "Specification 3"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE, type_slope = "deterministic")
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)
assert(nelem(model.seasonal_info) == 0)



print "Specification 4"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE)
bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = FALSE,\
                               type = "dum",\
                               frequency = 7)
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)
assert(nelem(model.seasonal_info) == 1)


print "Specification 5"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE)
bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = FALSE,\
                               type = "trig",\
                               frequency = 7)
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)
assert(nelem(model.seasonal_info) == 1)



/*  NOT WORKING YET!
print "Specification 6"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = FALSE)
bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = TRUE,\
                               type = "trig",\
                               frequency = 7)
model.seasonal_info.component_2 = _(stoch = FALSE,\
                               type = "dum",\
                               frequency = 365)
catch bundle model = STSM_setup(cnt, model)
# non-stochastic trig seasonality not supported
assert($error != FALSE)
assert(nelem(model.seasonal_info) == 2)

stop
*/


print "Specification 7: stochastic slope"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE,
                 type_slope = "stoch",
                 pe_trend = "stoch")
bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = TRUE,\
                               type = "dum",\
                               frequency = 7)
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)



print "Specification 8: stochastic trend"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = TRUE,
                 type_trend = "stoch")
/*bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = TRUE,\
                               type = "dum",\
                               frequency = 7)*/
bundle model = STSM_setup(cnt, model)
scalar err = STSM_estimate(&model)
list comps = STSM_components(model)
assert(err == FALSE)

###  NOT SUPPORTED CASES, YET

/*



print "Specification 7"
open bikesharing.gdt --quiet

bundle model = _(error_in_obseq = FALSE)
bundle model.seasonal_info = null
model.seasonal_info.component_1 = _(stoch = TRUE,\
                               type = "trig",\
                               frequency = 7)
model.seasonal_info.component_2 = _(stoch = FALSE,\
                               type = "dum",\
                               frequency = 365)
bundle model = STSM_setup(cnt, model)
# non-stochastic trig seasonality not supported
assert($error != FALSE)


*/



print "Successfully passed all tests"
quit
